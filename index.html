<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AscendX Learning Platform</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; background:#f3f4f6; }
  header { background:#1e40af; color:white; padding:1rem; text-align:center; font-size:1.5rem; }
  main { padding:1rem; }
  .module { background:white; margin:1rem 0; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  .lesson { margin:0.5rem 0; padding:0.5rem; background:#e0e7ff; border-radius:4px; cursor:pointer; }
  .lesson iframe { width:100%; height:200px; margin-top:0.5rem; }
  .admin-panel { background:#fef3c7; padding:1rem; margin:1rem 0; border-radius:8px; }
  input, textarea, select, button { margin:0.3rem 0; width:100%; padding:0.5rem; border-radius:4px; border:1px solid #ccc; }
  #playground { margin-top:1rem; width:100%; min-height:200px; background:white; border:1px solid #ccc; padding:0.5rem; border-radius:8px; }
</style>
</head>
<body>

<header>AscendX Learning Platform</header>

<main>
  <div id="modulesContainer"></div>

  <!-- Playground -->
  <h2>Code Playground</h2>
  <textarea id="codeInput" placeholder="Write HTML/JS/CSS here..." style="width:100%; height:150px;"></textarea>
  <button onclick="runPlayground()">Run Code</button>
  <iframe id="playground" sandbox="allow-scripts allow-same-origin"></iframe>

  <!-- Admin Panel -->
  <div class="admin-panel">
    <h2>Admin Panel</h2>
    <input type="password" id="adminPassword" placeholder="Enter admin password">
    <button onclick="loginAdmin()">Login as Admin</button>

    <div id="adminControls" style="display:none;">
      <h3>GitHub Token</h3>
      <input type="text" id="githubToken" placeholder="Paste your fine-grained token here">

      <h3>Add Module</h3>
      <input type="text" id="moduleTitle" placeholder="Module Title">
      <textarea id="moduleDesc" placeholder="Module Description"></textarea>
      <select id="moduleFree">
        <option value="true">Free</option>
        <option value="false">Premium</option>
      </select>
      <button onclick="addModule()">Add Module</button>

      <h3>Add Lesson (to last module)</h3>
      <input type="text" id="lessonTitle" placeholder="Lesson Title">
      <input type="text" id="lessonVideo" placeholder="YouTube embed URL (optional)">
      <textarea id="lessonText" placeholder="Lesson text"></textarea>
      <button onclick="addLesson()">Add Lesson</button>

      <button onclick="saveToGitHub()">Save to GitHub</button>
    </div>
  </div>
</main>

<script>
let coursesData = [];
let adminLoggedIn = false;
const ADMIN_PASSWORD = "ascendx123"; // Change this to your secure password

// ---------- Admin Login ----------
function loginAdmin() {
  const pw = document.getElementById('adminPassword').value;
  if(pw === ADMIN_PASSWORD) {
    adminLoggedIn = true;
    document.getElementById('adminControls').style.display = 'block';
    alert('Admin logged in!');
  } else {
    alert('Wrong password!');
  }
}

// ---------- Render Modules for Students ----------
function renderModules() {
  const container = document.getElementById('modulesContainer');
  container.innerHTML = '';
  coursesData.forEach((mod, idx) => {
    const modDiv = document.createElement('div');
    modDiv.className = 'module';
    modDiv.innerHTML = `<h3>${mod.title} ${mod.free ? '(Free)' : '(Premium)'}</h3>
                        <p>${mod.desc}</p>
                        <button onclick="toggleLessons(${idx})">Start Learning</button>
                        <div id="lessons${idx}" style="display:none;"></div>`;
    container.appendChild(modDiv);
  });
}

// ---------- Toggle Lessons ----------
function toggleLessons(index) {
  const lessonsDiv = document.getElementById('lessons'+index);
  lessonsDiv.style.display = lessonsDiv.style.display === 'none' ? 'block' : 'none';
  lessonsDiv.innerHTML = '';
  coursesData[index].lessons.forEach(lesson => {
    const lessonDiv = document.createElement('div');
    lessonDiv.className = 'lesson';
    lessonDiv.innerHTML = `<strong>${lesson.title}</strong>
      ${lesson.video ? `<iframe src="${lesson.video}" frameborder="0"></iframe>` : ''}
      <p>${lesson.text}</p>`;
    lessonsDiv.appendChild(lessonDiv);
  });
}

// ---------- Playground ----------
function runPlayground() {
  const code = document.getElementById('codeInput').value;
  const iframe = document.getElementById('playground');
  iframe.srcdoc = code;
}

// ---------- Admin Functions ----------
function addModule() {
  if(!adminLoggedIn) { alert('Login first!'); return; }
  const title = document.getElementById('moduleTitle').value;
  const desc = document.getElementById('moduleDesc').value;
  const free = document.getElementById('moduleFree').value === 'true';
  if(!title) return alert('Module title required');
  coursesData.push({title, desc, free, lessons:[]});
  renderModules();
  alert('Module added');
}

function addLesson() {
  if(!adminLoggedIn) { alert('Login first!'); return; }
  if(coursesData.length === 0) return alert('Add a module first');
  const title = document.getElementById('lessonTitle').value;
  const video = document.getElementById('lessonVideo').value;
  const text = document.getElementById('lessonText').value;
  if(!title) return alert('Lesson title required');
  coursesData[coursesData.length-1].lessons.push({title, video, text});
  renderModules();
  alert('Lesson added to last module');
}

// ---------- Save to GitHub ----------
async function saveToGitHub() {
  if(!adminLoggedIn) { alert('Login first!'); return; }

  const token = document.getElementById('githubToken').value.trim();
  if(!token) return alert('Paste your GitHub token');

  const repoOwner = 'Ray-Sage';
  const repoName = 'AscendX';
  const branch = 'main';
  const filePath = 'courses.json';

  try {

    // STEP 1 ‚Äî Try to get existing file
    const resGet = await fetch(
      `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}?ref=${branch}`,
      {
        headers: { Authorization: `Bearer ${token}` }
      }
    );

    let sha = null;

    if (resGet.status === 200) {
      const data = await resGet.json();
      sha = data.sha;
    }

    // STEP 2 ‚Äî Create or Update file
    const resPut = await fetch(
      `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`,
      {
        method: 'PUT',
        headers: {
          Authorization: `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: 'Update courses.json',
          content: btoa(JSON.stringify(coursesData, null, 2)),
          sha: sha, // null if file doesn't exist
          branch: branch
        })
      }
    );

    const result = await resPut.json();

    if (resPut.status === 200 || resPut.status === 201) {
      alert('‚úÖ Successfully saved to GitHub!');
    } else {
      alert('‚ùå GitHub Error: ' + JSON.stringify(result));
    }

  } catch (error) {
    alert('üî• Network/Error: ' + error.message);
  }
}

// Initial render
renderModules();
</script>

</body>
</html>
