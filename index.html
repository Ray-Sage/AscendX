<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AscendX</title>

<style>
body { font-family: Arial; margin:0; background:#f3f4f6; }
header { background:#1e40af; color:white; padding:15px; text-align:center; }
main { padding:15px; }

.module {
  background:white;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.lesson {
  background:#e0e7ff;
  padding:10px;
  margin-top:8px;
  border-radius:6px;
}

iframe { width:100%; height:200px; border:none; margin-top:8px; }

textarea, input, select, button {
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

button {
  background:#1e40af;
  color:white;
  border:none;
  margin-top:10px;
}

.admin {
  background:#fff3cd;
  padding:15px;
  margin-top:20px;
  border-radius:8px;
}
</style>
</head>

<body>

<header>AscendX Learning Platform</header>

<main>

<div id="modules"></div>

<h2>Code Playground</h2>
<textarea id="codeInput" placeholder="Write HTML/CSS/JS here..."></textarea>
<button onclick="runCode()">Run Code</button>
<iframe id="output"></iframe>

<div class="admin">
<h2>Admin Panel</h2>

<input type="password" id="adminPass" placeholder="Enter Admin Password">
<button onclick="login()">Login</button>

<div id="adminControls" style="display:none;">

<input type="text" id="githubToken" placeholder="Paste GitHub Token">

<h3>Add Module</h3>
<input type="text" id="modTitle" placeholder="Module Title">
<textarea id="modDesc" placeholder="Module Description"></textarea>
<select id="modFree">
<option value="true">Free</option>
<option value="false">Premium</option>
</select>
<button onclick="addModule()">Add Module</button>

<h3>Add Lesson (to last module)</h3>
<input type="text" id="lessonTitle" placeholder="Lesson Title">
<input type="text" id="lessonVideo" placeholder="YouTube Embed URL (optional)">
<textarea id="lessonText" placeholder="Lesson Text"></textarea>
<button onclick="addLesson()">Add Lesson</button>

<button onclick="saveToGitHub()">Save To GitHub</button>

</div>
</div>

</main>

<script>
const ADMIN_PASSWORD = "ascendx123"; 
let courses = [];
let loggedIn = false;

// Load courses.json from GitHub Pages
fetch("courses.json")
.then(res => res.json())
.then(data => {
  courses = data;
  render();
})
.catch(() => { courses = []; render(); });

// Render modules
function render(){
  const container = document.getElementById("modules");
  container.innerHTML = "";

  courses.forEach((mod, i) => {
    let div = document.createElement("div");
    div.className = "module";

    div.innerHTML = `
      <h3>${mod.title} ${mod.free ? "(Free)" : "(Premium)"}</h3>
      <p>${mod.desc}</p>
      <button onclick="toggle(${i})">View Lessons</button>
      <div id="lessons${i}" style="display:none;"></div>
    `;
    container.appendChild(div);
  });
}

function toggle(i){
  const div = document.getElementById("lessons"+i);
  div.style.display = div.style.display === "none" ? "block" : "none";
  div.innerHTML = "";

  courses[i].lessons.forEach(lesson => {
    let l = document.createElement("div");
    l.className = "lesson";
    l.innerHTML = `
      <strong>${lesson.title}</strong>
      ${lesson.video ? `<iframe src="${lesson.video}"></iframe>` : ""}
      <p>${lesson.text}</p>
    `;
    div.appendChild(l);
  });
}

// Playground
function runCode(){
  document.getElementById("output").srcdoc =
    document.getElementById("codeInput").value;
}

// Admin login
function login(){
  if(document.getElementById("adminPass").value === ADMIN_PASSWORD){
    loggedIn = true;
    document.getElementById("adminControls").style.display = "block";
    alert("Admin Logged In");
  } else {
    alert("Wrong Password");
  }
}

// Add module
function addModule(){
  if(!loggedIn) return alert("Login first");
  let title = document.getElementById("modTitle").value;
  if(!title) return alert("Module title required");

  courses.push({
    title: title,
    desc: document.getElementById("modDesc").value,
    free: document.getElementById("modFree").value === "true",
    lessons: []
  });

  render();
  alert("Module added");
}

// Add lesson
function addLesson(){
  if(!loggedIn) return alert("Login first");
  if(courses.length === 0) return alert("Add module first");

  let title = document.getElementById("lessonTitle").value;
  if(!title) return alert("Lesson title required");

  courses[courses.length-1].lessons.push({
    title: title,
    video: document.getElementById("lessonVideo").value,
    text: document.getElementById("lessonText").value
  });

  render();
  alert("Lesson added");
}

// Save to GitHub
async function saveToGitHub(){
  if(!loggedIn) return alert("Login first");

  const token = document.getElementById("githubToken").value.trim();
  if(!token) return alert("Paste GitHub token");

  const owner = "Ray-Sage";
  const repo = "AscendX";
  const branch = "main";
  const path = "courses.json";

  try {

    // Get SHA (if file exists)
    let sha = null;
    let resGet = await fetch(
      `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`,
      { headers: { Authorization: `Bearer ${token}` } }
    );

    if(resGet.status === 200){
      let data = await resGet.json();
      sha = data.sha;
    }

    // Create / Update file
    let resPut = await fetch(
      `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
      {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update courses.json",
          content: btoa(JSON.stringify(courses, null, 2)),
          sha: sha,
          branch: branch
        })
      }
    );

    let result = await resPut.json();

    if(resPut.status === 200 || resPut.status === 201){
      alert("‚úÖ Saved to GitHub successfully!");
    } else {
      alert("‚ùå GitHub Error: " + JSON.stringify(result));
    }

  } catch(e){
    alert("üî• Error: " + e.message);
  }
}
</script>

</body>
</html>
