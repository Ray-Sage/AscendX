<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AscendX Academy</title>

<style>
:root{
  --navy:#0b2340;
  --teal:#2aa6a1;
  --gold:#cfa939;
  --bg:#f6f8fb;
  --card:#ffffff;
  --muted:#6b7785;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  background:var(--bg);
  color:var(--navy);
}
.wrap{max-width:1100px;margin:auto;padding:16px}

header{
  display:flex;
  align-items:center;
  gap:12px;
  background:#fff;
  padding:12px;
  border-radius:12px;
  margin-bottom:16px;
}
.logo{
  width:48px;height:48px;
  background:linear-gradient(135deg,var(--navy),#123a57);
  color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;border-radius:10px;
}
.title{font-weight:700;font-size:18px}
.subtitle{font-size:13px;color:var(--muted)}

main{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:16px;
}
@media(max-width:900px){
  main{grid-template-columns:1fr}
}

.card{
  background:var(--card);
  padding:14px;
  border-radius:12px;
  margin-bottom:14px;
}

.module{
  border:1px solid #e5edf3;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  transition:0.3s;
}
.module:hover{transform:scale(1.01)}

.lesson-list{
  display:none;
  margin-top:10px;
  animation:fadein .3s ease;
}
.lesson{
  background:#f7fbfb;
  padding:8px;
  border-radius:8px;
  margin-top:6px;
}

.badge-free{color:var(--teal);font-weight:700}
.badge-premium{color:var(--gold);font-weight:700}

.btn{
  padding:6px 10px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
.btn.primary{background:var(--navy);color:#fff}
.btn.secondary{background:#fff;border:1px solid var(--navy);color:var(--navy)}

.video-wrap{
  position:relative;
  padding-top:56%;
  margin-top:10px;
}
.video-wrap iframe{
  position:absolute;left:0;top:0;
  width:100%;height:100%;
}

textarea{
  width:100%;
  height:140px;
  border-radius:8px;
  border:1px solid #e5edf3;
  padding:8px;
  font-family:monospace;
}
.preview{
  height:240px;
  border:1px solid #e5edf3;
  margin-top:8px;
}
@keyframes fadein{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>

<div class="wrap">

<header>
  <div class="logo">AX</div>
  <div>
    <div class="title">AscendX Academy</div>
    <div class="subtitle">Learn • Build • Excel</div>
  </div>
</header>

<main>

<section>
  <div class="card">
    <h2>Modules</h2>
    <div id="modules-list">Loading courses...</div>
  </div>
</section>

<aside>
  <div class="card">
    <strong>Now Playing:</strong>
    <div id="current-lesson-title">—</div>

    <div id="video-container" class="video-wrap" style="display:none;">
      <iframe id="lesson-video" allowfullscreen></iframe>
    </div>
  </div>

  <div class="card">
    <strong>Code Playground</strong>

    <textarea id="code-input"><!doctype html>
<html>
<body>
<h1>Hello AscendX</h1>
<p>Edit and press Run.</p>
</body>
</html></textarea>

    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn primary" id="run-btn">Run</button>
      <button class="btn secondary" id="copy-btn">Copy</button>
      <button class="btn" id="reset-btn">Reset</button>
    </div>

    <iframe id="code-output" class="preview"></iframe>
  </div>
</aside>

</main>
</div>

<script>
const USERNAME = "Ray-Sage";
const REPO = "AscendX";
const FILE_PATH = "courses.json";

let COURSES = { modules: [] };

async function fetchCoursesFromGitHub(){
  try{
    const url = `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${FILE_PATH}?t=${Date.now()}`;
    const r = await fetch(url,{cache:"no-store"});
    if(!r.ok) throw new Error("Fetch failed");

    const data = await r.json();
    const decoded = atob(data.content);
    COURSES = JSON.parse(decoded);

  }catch(err){
    console.error("Fetch error:",err);
    COURSES={modules:[]};
  }

  renderModules();
}

function renderModules(){
  const list=document.getElementById("modules-list");
  list.innerHTML="";

  (COURSES.modules||[]).forEach((m,midx)=>{
    const card=document.createElement("div");
    card.className="module";

    const badge=m.free
      ? '<span class="badge-free">FREE</span>'
      : '<span class="badge-premium">PREMIUM</span>';

    card.innerHTML=`
      <h3>${m.title} ${badge}</h3>
      <div>${m.desc||""}</div>
      <button class="btn primary" data-toggle="${midx}">Show Lessons</button>
      <div class="lesson-list" id="module-${midx}"></div>
    `;
    list.appendChild(card);

    const lessonList=card.querySelector(".lesson-list");

    (m.lessons||[]).forEach((les,lidx)=>{
      const lv=document.createElement("div");
      lv.className="lesson";
      lv.innerHTML=`
        <strong>${les.title}</strong>
        <div>${les.text||""}</div>
        <div style="margin-top:6px;display:flex;gap:6px">
          <button class="btn secondary" data-play="${midx}-${lidx}">Play</button>
          ${m.free?'':'<button class="btn primary">Unlock</button>'}
        </div>
      `;
      lessonList.appendChild(lv);
    });
  });
}

document.addEventListener("click",(e)=>{
  if(e.target.dataset.toggle){
    const id=e.target.dataset.toggle;
    const el=document.getElementById("module-"+id);
    el.style.display=el.style.display==="block"?"none":"block";
  }

  if(e.target.dataset.play){
    const [mid,lid]=e.target.dataset.play.split("-");
    const lesson=COURSES.modules[mid].lessons[lid];
    document.getElementById("current-lesson-title").textContent=lesson.title;

    if(lesson.video){
      document.getElementById("lesson-video").src=lesson.video;
      document.getElementById("video-container").style.display="block";
    }else{
      document.getElementById("video-container").style.display="none";
    }
  }
});

/* Playground */
function wirePlayground(){
  const input=document.getElementById("code-input");
  const output=document.getElementById("code-output");

  document.getElementById("run-btn").onclick=()=>{
    output.srcdoc=input.value;
  };

  document.getElementById("copy-btn").onclick=()=>{
    navigator.clipboard.writeText(input.value);
    alert("Copied!");
  };

  document.getElementById("reset-btn").onclick=()=>{
    input.value=`<!doctype html>
<html>
<body>
<h1>Hello AscendX</h1>
<p>Edit and press Run.</p>
</body>
</html>`;
    output.srcdoc=input.value;
  };

  output.srcdoc=input.value;
}

window.addEventListener("load",async()=>{
  await fetchCoursesFromGitHub();
  wirePlayground();
});
</script>

</body>
</html>
